# 개요

- 동시성은 **특정한 순서 없이** 겹치는 기간에 시작, 실행, 완료되는 여러 작업을 의미한다.
- 병렬성은 멀티코어 프로세서에서 동시에 실행되는 동일한 작업의 여러 작업에 관한 것이다.

---
# 동시성 (Concurrent)

- 동시성은 CPU가 한번에 많은 일을 처리하는 것에 중점을 두게된다.
    - 즉 많은 작업들을 아주 빠른 시간으로 **교체**하면서 전체 작업을 처리하게된다.
- 동시성은 작업의 처리를 빠르게 하기 위한 목적이 아닌 CPU를 효율적으로 사용하는데 중점을 둔다.
    - 스레드가 작업을 처리하다 **IO 블록**(입/출력)에 걸렸을 경우에는 CPU가 작업을 처리하지 않는다.
    - 그렇기 때문에 CPU는 다른 스레드로 전환하며 작업을 진행한다.
- 동시성은 작업에 대한 처리방식을 어떤 식으로 진행할 것인가에 대한 **설계적 관점**에서 이해가 필요하다.
- 동시성은 작업해야 할 수가 CPU 코더수보다 많을 경우 해당되며 동시성이 없으면 작업을 순차적으로 진행해야 한다.

---

# 병렬성 (Parallel)

- 병렬성은 **CPU 가 동시에 많은 일을 수행**하는 것에 중점을 둔다.
    - 즉 CPU가 놀지 않고 최대한 바쁘게 동작해야 한다.
- 병렬성은 런타임에 동시에 물리적으로 작업을 실행하는 것이며 여러 컴퓨팅 리소스가 있는 하드웨어가 필요하다.
    - 즉 한 개의 코어에서는 절대 병렬성이 구현될 수 없다.
- 병렬성은 **동시성의 하위 개념**으로 작업을 여러 Thread로 분리하고, 운영체제는 그 Thread를 여러 CPU에 적절히 분배하여 동시적으로 실행되도록 하는 것이다.
- 동시성이 작업 처리 방식에 대한 설계에 관한 것이라면 병렬성은 하드웨어에서 계층에서 작업 수행 방식에 관한 것이다.
- 병렬성은 작업해야 할 수가 CPU 코어 수 보다 같거나 적을 경우 가장 효율성이 좋다.

---

# 병렬성과 동시성 조합

## ThreadPoolExecutor

- 병렬성으로 처리 성능을 극대화 하고 동시성으로 CPU 자원을 효율적으로 운용한다

# Parallelism - Divide and Conquer

## ForkJoinPool

- 분할정복 알고리즘을 이용한 방법
- 하나의 태스크를 서브 태스크로 분할하여 병렬처리함으로써 전체 작업 성능을 높인다.

---
# 예제

## ParallelismExample
- CPU 개수에 맞춰 최적화된 병렬 처리를 수행한다.
- parallelStream()을 사용하여 작업을 수행하며, 내부적으로 ForkJoinPool을 활용하여 병렬 처리를 진행한다.
- CPU 코어 개수와 동일한 개수의 데이터를 처리하므로, 최소한의 컨텍스트 스위칭과 오버헤드로 최적의 성능을 기대할 수 있다.

```java
long sum = data.parallelStream()
        .mapToLong(i -> {
            try {
                Thread.sleep(500);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
            return i * i;
        })
        .sum();
```

## ConcurrencyExample
- CPU 개수보다 많은 데이터(CPU 개수 * 2)를 병렬로 처리한다.
- Runtime.getRuntime().availableProcessors() * 2;을 사용하여 2배의 데이터를 생성하고 parallelStream()을 통해 실행한다.
- CPU 코어 개수를 초과하는 데이터가 입력되면서, 일부 작업이 대기해야 하는 상황이 발생하여 컨텍스트 스위칭이 증가한다.

⸻

## 결론

- 병렬 처리의 성능은 CPU 코어 수와 데이터 크기에 따라 달라진다.
- ParallelismExample은 CPU 코어 개수만큼 데이터를 실행하여 최적의 병렬 처리 성능을 보장한다.
- ConcurrencyExample은 CPU 코어 개수보다 많은 데이터를 실행하여 컨텍스트 스위칭 비용이 증가하고, 실행 시간이 늘어날 수 있다.
- 적절한 스레드 개수를 유지해야 병렬 처리의 효율이 높아지며, 과도한 병렬 작업은 성능을 저하시킬 수 있다.
